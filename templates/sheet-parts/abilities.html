<div>
  <h2>Abilities</h2>
  <h3>Equip a weapon:</h3>
  <table>
    <tr>
      <th></th>
      <th>Item</th>
      <th>Stat</th>
      <th>Action</th>
      <th>Range</th>
      <th>Description</th>
    </tr>
    {{#each all_items.weapon as |item key|}}
      <tr class="item" data-item-id="{{item.id}}">
        <td><input type="radio" value="{{item.id}}" name="system.equipped_weapon" {{#if (eq item.id ../system.equipped_weapon)}}checked{{/if}}/>
        <td>{{item.name}}</td>
        <td>{{item.system.stat}}</td>
        <td>
          {{# if item.system.action}}
            {{> (component "icon-with-wrap") 
              title="Use action"
              filename=(concat 'action-' item.system.action)
              click_class=(getAbilityActionClass item ../action_info)
              data=(data_fields 
                "action" item.system.action
              )
            }}
          {{/if}}
        </td>
        <td>{{item.system.range}}</td>
        <td>{{{item.system.description}}}</td>
        <td>
          {{#with (getDiceForWeapon item) as |dice|}}
            {{> (component "icon-with-wrap") 
              title="Roll menu"
              filename="boon"
              click_class="roll-skill-boon"
              extra_classes="roll-icon"
              data=(data_fields 
                "name" item.name
                "d1" dice.d1
                "d2" dice.d2
              )
            }}
          {{/with}}
        </td>
        <td>
          <div class="item-controls">
            <a class="edit-item"><i class="fas fa-edit"></i></a>
            <a class="delete-item"><i class="fas fa-trash"></i></a>
          </div>
        </td>
      </tr>
    {{/each}}
    <a class="item-create" data-type="weapon"><i class="fas fa-plus"></i> Add Weapon</a>
  </table>
  <h3>Abilities</h3>
  <table>
    <tr>
      <th>Name</th>
      <th>Skill</th>
      <th>Cost</th>
      <th></th>
      <th>Description</th>
    </tr>
    {{#each all_items.ability as |ability|}}
      {{#with (getOverridesForAbility ability) as |overrides|}}
        <tr class="item" data-item-id="{{ability.id}}">
          <td>{{ability.name}}</td>
          <td>{{overrides.skill}}</td>
          <td>
            {{# if ability.system.cost}}
              {{> (component "icon-with-wrap") 
                title="Pay cost"
                filename=ability.system.costtype
                click_class=(getAbilityCostClass ability)
                extra_text=(concat "x " ability.system.cost)
                data=(data_fields 
                  "cost" ability.system.cost
                  "costtype" ability.system.costtype
                )
              }}
            {{/if}}
          </td>
          <td>
            {{# if (and overrides.action (neq overrides.action "none"))}}
              {{> (component "icon-with-wrap") 
                title="Use action"
                filename=(concat 'action-' overrides.action)
                click_class=(getAbilityActionClass ability ../../action_info overrides)
                data=(data_fields 
                  "action" overrides.action
                )
              }}
            {{/if}}
          </td>
          <td>{{{ability.system.description}}}</td>
          {{#if overrides.dice}}
          {{#if (eq ability.system.roll_type "help")}}
          <td>
            {{> (component "icon-with-wrap") 
              title="Help another"
              filename="help"
              click_class="roll-skill-boon"
              extra_classes="roll-icon"
              data=(data_fields 
                "name" ability.name
                "d1" "-1"
                "d2" "-1"
                "d3" overrides.dice.d3
              )
            }}
          </td>
          {{else}}
          <td>
            {{> (component "icon-with-wrap") 
              title="Roll menu"
              filename="boon"
              click_class="roll-skill-boon"
              extra_classes="roll-icon"
              data=(data_fields 
                "name" ability.name
                "d1" overrides.dice.d1
                "d2" overrides.dice.d2
              )
            }}
          </td>
          {{/if}}
          {{else}}
          <td></td>
          {{/if}}
          <td>
            <div class="item-controls">
              <a class="edit-item"><i class="fas fa-edit"></i></a>
              <a class="delete-item"><i class="fas fa-trash"></i></a>
            </div>
          </td>
        </tr>
      {{/with}}
    {{/each}}
    <a class="item-create" data-type="ability"><i class="fas fa-plus"></i> Add Ability</a>
  </table>
</div>